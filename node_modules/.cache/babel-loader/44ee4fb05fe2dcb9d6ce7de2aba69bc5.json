{"ast":null,"code":"import React from \"react\";\nimport * as THREE from 'three';\nimport { TrackballControls } from '../../node_modules/three/examples/jsm/controls/TrackballControls.js';\nimport { PDBLoader } from '../../node_modules/three/examples/jsm/loaders/PDBLoader.js';\nimport { CSS3DRenderer, CSS3DObject, CSS3DSprite } from '../../node_modules/three/examples/jsm/renderers/CSS3DRenderer.js';\n\nfunction MainPage() {\n  let camera, scene, renderer;\n  let controls;\n  let root;\n  const objects = [];\n  const tmpVec1 = new THREE.Vector3();\n  const tmpVec2 = new THREE.Vector3();\n  const tmpVec3 = new THREE.Vector3();\n  const tmpVec4 = new THREE.Vector3();\n  const offset = new THREE.Vector3();\n  let visualizationType = 2;\n  const MOLECULES = {\n    'Rufinamide': 'rufinamide.pdb' //'Sildenafil': 'sildenafil.pdb',\n    // 'Lidocaine': 'lidocaine.pdb',\n    // 'Nytol': 'nytol.pdb',\n    // 'Rufinamide': 'rufinamide.pdb',\n    // 'LSD': 'lsd.pdb',\n    // 'Cocaine': 'cocaine.pdb',\n    // 'Cholesterol': 'cholesterol.pdb',\n    // 'Lycopene': 'lycopene.pdb',\n    // 'Glucose': 'glucose.pdb',\n    // 'Aluminium oxide': 'Al2O3.pdb',\n    // 'Cubane': 'cubane.pdb',\n    // 'Copper': 'cu.pdb',\n    // 'Fluorite': 'caf2.pdb',\n    // 'Salt': 'nacl.pdb',\n    // 'YBCO superconductor': 'ybco.pdb',\n    // 'Buckyball': 'buckyball.pdb',\n    // // 'Diamond': 'diamond.pdb',\n    // 'Graphite': 'graphite.pdb'\n\n  };\n  const loader = new PDBLoader();\n  const colorSpriteMap = {};\n  const baseSprite = document.createElement('img');\n  const menu = document.getElementById('menu');\n  init();\n  animate();\n\n  function init() {\n    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 5000);\n    camera.position.z = 1000;\n    scene = new THREE.Scene();\n    root = new THREE.Object3D();\n    scene.add(root); //\n\n    renderer = new CSS3DRenderer();\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    document.getElementById('container').appendChild(renderer.domElement); //\n\n    controls = new TrackballControls(camera, renderer.domElement);\n    controls.rotateSpeed = 0.5; //\n\n    baseSprite.onload = function () {\n      const url = './models/pdb/rufinamide.pdb';\n      loadMolecule(url); //createMenu();\n    };\n\n    baseSprite.src = './textures/sprites/ball.png'; //\n\n    window.addEventListener('resize', onWindowResize);\n  } //\n\n\n  function generateButtonCallback(url) {\n    return function () {\n      loadMolecule(url);\n    };\n  }\n\n  function createMenu() {\n    for (const m in MOLECULES) {\n      const button = document.createElement('button');\n      button.innerHTML = m;\n      menu.appendChild(button);\n      const url = './models/pdb/' + MOLECULES[m];\n      button.addEventListener('click', generateButtonCallback(url));\n    }\n\n    const b_a = document.getElementById('b_a');\n    const b_b = document.getElementById('b_b');\n    const b_ab = document.getElementById('b_ab');\n    b_a.addEventListener('click', function () {\n      visualizationType = 0; // showAtoms();\n    });\n    b_b.addEventListener('click', function () {\n      visualizationType = 1; // showBonds();\n    });\n    b_ab.addEventListener('click', function () {\n      visualizationType = 2; // showAtomsBonds();\n    });\n  } //\n\n\n  function showAtoms() {\n    for (let i = 0; i < objects.length; i++) {\n      const object = objects[i];\n\n      if (object instanceof CSS3DSprite) {\n        object.element.style.display = '';\n        object.visible = true;\n      } else {\n        object.element.style.display = 'none';\n        object.visible = false;\n      }\n    }\n  }\n\n  function showBonds() {\n    for (let i = 0; i < objects.length; i++) {\n      const object = objects[i];\n\n      if (object instanceof CSS3DSprite) {\n        object.element.style.display = 'none';\n        object.visible = false;\n      } else {\n        object.element.style.display = '';\n        object.element.style.height = object.userData.bondLengthFull;\n        object.visible = true;\n      }\n    }\n  }\n\n  function showAtomsBonds() {\n    for (let i = 0; i < objects.length; i++) {\n      const object = objects[i];\n      object.element.style.display = '';\n      object.visible = true;\n\n      if (!(object instanceof CSS3DSprite)) {\n        object.element.style.height = object.userData.bondLengthShort;\n      }\n    }\n  } //\n\n\n  function colorify(ctx, width, height, color) {\n    const r = color.r,\n          g = color.g,\n          b = color.b;\n    const imageData = ctx.getImageData(0, 0, width, height);\n    const data = imageData.data;\n\n    for (let i = 0, l = data.length; i < l; i += 4) {\n      data[i + 0] *= r;\n      data[i + 1] *= g;\n      data[i + 2] *= b;\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  function imageToCanvas(image) {\n    const width = image.width;\n    const height = image.height;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const context = canvas.getContext('2d');\n    context.drawImage(image, 0, 0, width, height);\n    return canvas;\n  } //\n\n\n  function loadMolecule(url) {\n    for (let i = 0; i < objects.length; i++) {\n      const object = objects[i];\n      object.parent.remove(object);\n    }\n\n    objects.length = 0;\n    loader.load(url, function (pdb) {\n      const geometryAtoms = pdb.geometryAtoms;\n      const geometryBonds = pdb.geometryBonds;\n      const json = pdb.json;\n      geometryAtoms.computeBoundingBox();\n      geometryAtoms.boundingBox.getCenter(offset).negate();\n      geometryAtoms.translate(offset.x, offset.y, offset.z);\n      geometryBonds.translate(offset.x, offset.y, offset.z);\n      const positionAtoms = geometryAtoms.getAttribute('position');\n      const colorAtoms = geometryAtoms.getAttribute('color');\n      const position = new THREE.Vector3();\n      const color = new THREE.Color();\n\n      for (let i = 0; i < positionAtoms.count; i++) {\n        position.fromBufferAttribute(positionAtoms, i);\n        color.fromBufferAttribute(colorAtoms, i);\n        const atomJSON = json.atoms[i];\n        const element = atomJSON[4];\n\n        if (!colorSpriteMap[element]) {\n          const canvas = imageToCanvas(baseSprite);\n          const context = canvas.getContext('2d');\n          colorify(context, canvas.width, canvas.height, color);\n          const dataUrl = canvas.toDataURL();\n          colorSpriteMap[element] = dataUrl;\n        }\n\n        const colorSprite = colorSpriteMap[element];\n        const atom = document.createElement('img');\n        atom.src = colorSprite;\n        const object = new CSS3DSprite(atom);\n        object.position.copy(position);\n        object.position.multiplyScalar(75);\n        object.matrixAutoUpdate = false;\n        object.updateMatrix();\n        root.add(object);\n        objects.push(object);\n      }\n\n      const positionBonds = geometryBonds.getAttribute('position');\n      const start = new THREE.Vector3();\n      const end = new THREE.Vector3();\n\n      for (let i = 0; i < positionBonds.count; i += 2) {\n        start.fromBufferAttribute(positionBonds, i);\n        end.fromBufferAttribute(positionBonds, i + 1);\n        start.multiplyScalar(75);\n        end.multiplyScalar(75);\n        tmpVec1.subVectors(end, start);\n        const bondLength = tmpVec1.length() - 50; //\n\n        let bond = document.createElement('div');\n        bond.className = 'bond';\n        bond.style.height = bondLength + 'px';\n        let object = new CSS3DObject(bond);\n        object.position.copy(start);\n        object.position.lerp(end, 0.5);\n        object.userData.bondLengthShort = bondLength + 'px';\n        object.userData.bondLengthFull = bondLength + 55 + 'px'; //\n\n        const axis = tmpVec2.set(0, 1, 0).cross(tmpVec1);\n        const radians = Math.acos(tmpVec3.set(0, 1, 0).dot(tmpVec4.copy(tmpVec1).normalize()));\n        const objMatrix = new THREE.Matrix4().makeRotationAxis(axis.normalize(), radians);\n        object.matrix.copy(objMatrix);\n        object.quaternion.setFromRotationMatrix(object.matrix);\n        object.matrixAutoUpdate = false;\n        object.updateMatrix();\n        root.add(object);\n        objects.push(object); //\n\n        bond = document.createElement('div');\n        bond.className = 'bond';\n        bond.style.height = bondLength + 'px';\n        const joint = new THREE.Object3D(bond);\n        joint.position.copy(start);\n        joint.position.lerp(end, 0.5);\n        joint.matrix.copy(objMatrix);\n        joint.quaternion.setFromRotationMatrix(joint.matrix);\n        joint.matrixAutoUpdate = false;\n        joint.updateMatrix();\n        object = new CSS3DObject(bond);\n        object.rotation.y = Math.PI / 2;\n        object.matrixAutoUpdate = false;\n        object.updateMatrix();\n        object.userData.bondLengthShort = bondLength + 'px';\n        object.userData.bondLengthFull = bondLength + 55 + 'px';\n        object.userData.joint = joint;\n        joint.add(object);\n        root.add(joint);\n        objects.push(object);\n      } //console.log( \"CSS3DObjects:\", objects.length );\n\n\n      switch (visualizationType) {\n        case 0:\n          showAtoms();\n          break;\n\n        case 1:\n          showBonds();\n          break;\n\n        case 2:\n          showAtomsBonds();\n          break;\n      }\n    });\n  } //\n\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight;\n    camera.updateProjectionMatrix();\n    renderer.setSize(window.innerWidth, window.innerHeight);\n  }\n\n  function animate() {\n    requestAnimationFrame(animate);\n    controls.update();\n    const time = Date.now() * 0.0004; // root.rotation.x = time;\n\n    root.rotation.y = time * 0.7;\n    render();\n  }\n\n  function render() {\n    renderer.render(scene, camera); //requestAnimationFrame(render);\n  }\n\n  return null;\n}\n\nexport default MainPage;","map":{"version":3,"sources":["C:/Users/aamir/code/chemifyApp/src/components/MainPage.jsx"],"names":["React","THREE","TrackballControls","PDBLoader","CSS3DRenderer","CSS3DObject","CSS3DSprite","MainPage","camera","scene","renderer","controls","root","objects","tmpVec1","Vector3","tmpVec2","tmpVec3","tmpVec4","offset","visualizationType","MOLECULES","loader","colorSpriteMap","baseSprite","document","createElement","menu","getElementById","init","animate","PerspectiveCamera","window","innerWidth","innerHeight","position","z","Scene","Object3D","add","setSize","appendChild","domElement","rotateSpeed","onload","url","loadMolecule","src","addEventListener","onWindowResize","generateButtonCallback","createMenu","m","button","innerHTML","b_a","b_b","b_ab","showAtoms","i","length","object","element","style","display","visible","showBonds","height","userData","bondLengthFull","showAtomsBonds","bondLengthShort","colorify","ctx","width","color","r","g","b","imageData","getImageData","data","l","putImageData","imageToCanvas","image","canvas","context","getContext","drawImage","parent","remove","load","pdb","geometryAtoms","geometryBonds","json","computeBoundingBox","boundingBox","getCenter","negate","translate","x","y","positionAtoms","getAttribute","colorAtoms","Color","count","fromBufferAttribute","atomJSON","atoms","dataUrl","toDataURL","colorSprite","atom","copy","multiplyScalar","matrixAutoUpdate","updateMatrix","push","positionBonds","start","end","subVectors","bondLength","bond","className","lerp","axis","set","cross","radians","Math","acos","dot","normalize","objMatrix","Matrix4","makeRotationAxis","matrix","quaternion","setFromRotationMatrix","joint","rotation","PI","aspect","updateProjectionMatrix","requestAnimationFrame","update","time","Date","now","render"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,KAAKC,KAAZ,MAAuB,OAAvB;AACA,SAASC,iBAAT,QAAkC,qEAAlC;AACA,SAASC,SAAT,QAA0B,4DAA1B;AACA,SAASC,aAAT,EAAwBC,WAAxB,EAAqCC,WAArC,QAAwD,kEAAxD;;AAEA,SAASC,QAAT,GAAoB;AAEjB,MAAIC,MAAJ,EAAYC,KAAZ,EAAmBC,QAAnB;AACA,MAAIC,QAAJ;AACA,MAAIC,IAAJ;AAEA,QAAMC,OAAO,GAAG,EAAhB;AACA,QAAMC,OAAO,GAAG,IAAIb,KAAK,CAACc,OAAV,EAAhB;AACA,QAAMC,OAAO,GAAG,IAAIf,KAAK,CAACc,OAAV,EAAhB;AACA,QAAME,OAAO,GAAG,IAAIhB,KAAK,CAACc,OAAV,EAAhB;AACA,QAAMG,OAAO,GAAG,IAAIjB,KAAK,CAACc,OAAV,EAAhB;AACA,QAAMI,MAAM,GAAG,IAAIlB,KAAK,CAACc,OAAV,EAAf;AAEA,MAAIK,iBAAiB,GAAG,CAAxB;AAEA,QAAMC,SAAS,GAAG;AACjB,kBAAc,gBADG,CAEjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAnBiB,GAAlB;AAsBA,QAAMC,MAAM,GAAG,IAAInB,SAAJ,EAAf;AACA,QAAMoB,cAAc,GAAG,EAAvB;AACA,QAAMC,UAAU,GAAGC,QAAQ,CAACC,aAAT,CAAwB,KAAxB,CAAnB;AAEA,QAAMC,IAAI,GAAGF,QAAQ,CAACG,cAAT,CAAyB,MAAzB,CAAb;AAGAC,EAAAA,IAAI;AACJC,EAAAA,OAAO;;AAEP,WAASD,IAAT,GAAgB;AAEfrB,IAAAA,MAAM,GAAG,IAAIP,KAAK,CAAC8B,iBAAV,CAA6B,EAA7B,EAAiCC,MAAM,CAACC,UAAP,GAAoBD,MAAM,CAACE,WAA5D,EAAyE,CAAzE,EAA4E,IAA5E,CAAT;AACA1B,IAAAA,MAAM,CAAC2B,QAAP,CAAgBC,CAAhB,GAAoB,IAApB;AAEA3B,IAAAA,KAAK,GAAG,IAAIR,KAAK,CAACoC,KAAV,EAAR;AAEAzB,IAAAA,IAAI,GAAG,IAAIX,KAAK,CAACqC,QAAV,EAAP;AACA7B,IAAAA,KAAK,CAAC8B,GAAN,CAAW3B,IAAX,EARe,CAUf;;AAEAF,IAAAA,QAAQ,GAAG,IAAIN,aAAJ,EAAX;AACAM,IAAAA,QAAQ,CAAC8B,OAAT,CAAkBR,MAAM,CAACC,UAAzB,EAAqCD,MAAM,CAACE,WAA5C;AACAT,IAAAA,QAAQ,CAACG,cAAT,CAAyB,WAAzB,EAAuCa,WAAvC,CAAoD/B,QAAQ,CAACgC,UAA7D,EAde,CAgBf;;AAEA/B,IAAAA,QAAQ,GAAG,IAAIT,iBAAJ,CAAuBM,MAAvB,EAA+BE,QAAQ,CAACgC,UAAxC,CAAX;AACA/B,IAAAA,QAAQ,CAACgC,WAAT,GAAuB,GAAvB,CAnBe,CAqBf;;AAEAnB,IAAAA,UAAU,CAACoB,MAAX,GAAoB,YAAY;AAE/B,YAAMC,GAAG,GAAG,6BAAZ;AACAC,MAAAA,YAAY,CAAED,GAAF,CAAZ,CAH+B,CAI/B;AAEA,KAND;;AAQArB,IAAAA,UAAU,CAACuB,GAAX,GAAiB,6BAAjB,CA/Be,CAiCf;;AAEAf,IAAAA,MAAM,CAACgB,gBAAP,CAAyB,QAAzB,EAAmCC,cAAnC;AAEA,GApFgB,CAsFjB;;;AAEA,WAASC,sBAAT,CAAiCL,GAAjC,EAAuC;AAEtC,WAAO,YAAY;AAElBC,MAAAA,YAAY,CAAED,GAAF,CAAZ;AAEA,KAJD;AAMA;;AAED,WAASM,UAAT,GAAsB;AAErB,SAAM,MAAMC,CAAZ,IAAiB/B,SAAjB,EAA6B;AAG5B,YAAMgC,MAAM,GAAG5B,QAAQ,CAACC,aAAT,CAAwB,QAAxB,CAAf;AACA2B,MAAAA,MAAM,CAACC,SAAP,GAAmBF,CAAnB;AACAzB,MAAAA,IAAI,CAACc,WAAL,CAAkBY,MAAlB;AAEA,YAAMR,GAAG,GAAG,kBAAkBxB,SAAS,CAAE+B,CAAF,CAAvC;AAEAC,MAAAA,MAAM,CAACL,gBAAP,CAAyB,OAAzB,EAAkCE,sBAAsB,CAAEL,GAAF,CAAxD;AAEA;;AAED,UAAMU,GAAG,GAAG9B,QAAQ,CAACG,cAAT,CAAyB,KAAzB,CAAZ;AACA,UAAM4B,GAAG,GAAG/B,QAAQ,CAACG,cAAT,CAAyB,KAAzB,CAAZ;AACA,UAAM6B,IAAI,GAAGhC,QAAQ,CAACG,cAAT,CAAyB,MAAzB,CAAb;AAEA2B,IAAAA,GAAG,CAACP,gBAAJ,CAAsB,OAAtB,EAA+B,YAAY;AAE1C5B,MAAAA,iBAAiB,GAAG,CAApB,CAF0C,CAG1C;AAEA,KALD;AAMAoC,IAAAA,GAAG,CAACR,gBAAJ,CAAsB,OAAtB,EAA+B,YAAY;AAE1C5B,MAAAA,iBAAiB,GAAG,CAApB,CAF0C,CAG1C;AAEA,KALD;AAMAqC,IAAAA,IAAI,CAACT,gBAAL,CAAuB,OAAvB,EAAgC,YAAY;AAE3C5B,MAAAA,iBAAiB,GAAG,CAApB,CAF2C,CAG3C;AAEA,KALD;AAOA,GAxIgB,CA0IjB;;;AAEA,WAASsC,SAAT,GAAqB;AAEpB,SAAM,IAAIC,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG9C,OAAO,CAAC+C,MAA7B,EAAqCD,CAAC,EAAtC,EAA4C;AAE3C,YAAME,MAAM,GAAGhD,OAAO,CAAE8C,CAAF,CAAtB;;AAEA,UAAKE,MAAM,YAAYvD,WAAvB,EAAqC;AAEpCuD,QAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBC,OAArB,GAA+B,EAA/B;AACAH,QAAAA,MAAM,CAACI,OAAP,GAAiB,IAAjB;AAEA,OALD,MAKO;AAENJ,QAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBC,OAArB,GAA+B,MAA/B;AACAH,QAAAA,MAAM,CAACI,OAAP,GAAiB,KAAjB;AAEA;AAED;AAED;;AAED,WAASC,SAAT,GAAqB;AAEpB,SAAM,IAAIP,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG9C,OAAO,CAAC+C,MAA7B,EAAqCD,CAAC,EAAtC,EAA4C;AAE3C,YAAME,MAAM,GAAGhD,OAAO,CAAE8C,CAAF,CAAtB;;AAEA,UAAKE,MAAM,YAAYvD,WAAvB,EAAqC;AAEpCuD,QAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBC,OAArB,GAA+B,MAA/B;AACAH,QAAAA,MAAM,CAACI,OAAP,GAAiB,KAAjB;AAEA,OALD,MAKO;AAENJ,QAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBC,OAArB,GAA+B,EAA/B;AACAH,QAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBI,MAArB,GAA8BN,MAAM,CAACO,QAAP,CAAgBC,cAA9C;AACAR,QAAAA,MAAM,CAACI,OAAP,GAAiB,IAAjB;AAEA;AAED;AAED;;AAED,WAASK,cAAT,GAA0B;AAEzB,SAAM,IAAIX,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG9C,OAAO,CAAC+C,MAA7B,EAAqCD,CAAC,EAAtC,EAA4C;AAE3C,YAAME,MAAM,GAAGhD,OAAO,CAAE8C,CAAF,CAAtB;AAEAE,MAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBC,OAArB,GAA+B,EAA/B;AACAH,MAAAA,MAAM,CAACI,OAAP,GAAiB,IAAjB;;AAEA,UAAK,EAAIJ,MAAM,YAAYvD,WAAtB,CAAL,EAA2C;AAE1CuD,QAAAA,MAAM,CAACC,OAAP,CAAeC,KAAf,CAAqBI,MAArB,GAA8BN,MAAM,CAACO,QAAP,CAAgBG,eAA9C;AAEA;AAED;AAED,GA1MgB,CA4MjB;;;AAEA,WAASC,QAAT,CAAmBC,GAAnB,EAAwBC,KAAxB,EAA+BP,MAA/B,EAAuCQ,KAAvC,EAA+C;AAE9C,UAAMC,CAAC,GAAGD,KAAK,CAACC,CAAhB;AAAA,UAAmBC,CAAC,GAAGF,KAAK,CAACE,CAA7B;AAAA,UAAgCC,CAAC,GAAGH,KAAK,CAACG,CAA1C;AAEA,UAAMC,SAAS,GAAGN,GAAG,CAACO,YAAJ,CAAkB,CAAlB,EAAqB,CAArB,EAAwBN,KAAxB,EAA+BP,MAA/B,CAAlB;AACA,UAAMc,IAAI,GAAGF,SAAS,CAACE,IAAvB;;AAEA,SAAM,IAAItB,CAAC,GAAG,CAAR,EAAWuB,CAAC,GAAGD,IAAI,CAACrB,MAA1B,EAAkCD,CAAC,GAAGuB,CAAtC,EAAyCvB,CAAC,IAAI,CAA9C,EAAkD;AAEjDsB,MAAAA,IAAI,CAAEtB,CAAC,GAAG,CAAN,CAAJ,IAAiBiB,CAAjB;AACAK,MAAAA,IAAI,CAAEtB,CAAC,GAAG,CAAN,CAAJ,IAAiBkB,CAAjB;AACAI,MAAAA,IAAI,CAAEtB,CAAC,GAAG,CAAN,CAAJ,IAAiBmB,CAAjB;AAEA;;AAEDL,IAAAA,GAAG,CAACU,YAAJ,CAAkBJ,SAAlB,EAA6B,CAA7B,EAAgC,CAAhC;AAEA;;AAED,WAASK,aAAT,CAAwBC,KAAxB,EAAgC;AAE/B,UAAMX,KAAK,GAAGW,KAAK,CAACX,KAApB;AACA,UAAMP,MAAM,GAAGkB,KAAK,CAAClB,MAArB;AAEA,UAAMmB,MAAM,GAAG7D,QAAQ,CAACC,aAAT,CAAwB,QAAxB,CAAf;AAEA4D,IAAAA,MAAM,CAACZ,KAAP,GAAeA,KAAf;AACAY,IAAAA,MAAM,CAACnB,MAAP,GAAgBA,MAAhB;AAEA,UAAMoB,OAAO,GAAGD,MAAM,CAACE,UAAP,CAAmB,IAAnB,CAAhB;AACAD,IAAAA,OAAO,CAACE,SAAR,CAAmBJ,KAAnB,EAA0B,CAA1B,EAA6B,CAA7B,EAAgCX,KAAhC,EAAuCP,MAAvC;AAEA,WAAOmB,MAAP;AAEA,GAhPgB,CAkPjB;;;AAEA,WAASxC,YAAT,CAAuBD,GAAvB,EAA6B;AAE5B,SAAM,IAAIc,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG9C,OAAO,CAAC+C,MAA7B,EAAqCD,CAAC,EAAtC,EAA4C;AAE3C,YAAME,MAAM,GAAGhD,OAAO,CAAE8C,CAAF,CAAtB;AACAE,MAAAA,MAAM,CAAC6B,MAAP,CAAcC,MAAd,CAAsB9B,MAAtB;AAEA;;AAEDhD,IAAAA,OAAO,CAAC+C,MAAR,GAAiB,CAAjB;AAEAtC,IAAAA,MAAM,CAACsE,IAAP,CAAa/C,GAAb,EAAkB,UAAWgD,GAAX,EAAiB;AAElC,YAAMC,aAAa,GAAGD,GAAG,CAACC,aAA1B;AACA,YAAMC,aAAa,GAAGF,GAAG,CAACE,aAA1B;AACA,YAAMC,IAAI,GAAGH,GAAG,CAACG,IAAjB;AAEAF,MAAAA,aAAa,CAACG,kBAAd;AACAH,MAAAA,aAAa,CAACI,WAAd,CAA0BC,SAA1B,CAAqChF,MAArC,EAA8CiF,MAA9C;AAEAN,MAAAA,aAAa,CAACO,SAAd,CAAyBlF,MAAM,CAACmF,CAAhC,EAAmCnF,MAAM,CAACoF,CAA1C,EAA6CpF,MAAM,CAACiB,CAApD;AACA2D,MAAAA,aAAa,CAACM,SAAd,CAAyBlF,MAAM,CAACmF,CAAhC,EAAmCnF,MAAM,CAACoF,CAA1C,EAA6CpF,MAAM,CAACiB,CAApD;AAEA,YAAMoE,aAAa,GAAGV,aAAa,CAACW,YAAd,CAA4B,UAA5B,CAAtB;AACA,YAAMC,UAAU,GAAGZ,aAAa,CAACW,YAAd,CAA4B,OAA5B,CAAnB;AAEA,YAAMtE,QAAQ,GAAG,IAAIlC,KAAK,CAACc,OAAV,EAAjB;AACA,YAAM4D,KAAK,GAAG,IAAI1E,KAAK,CAAC0G,KAAV,EAAd;;AAEA,WAAM,IAAIhD,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG6C,aAAa,CAACI,KAAnC,EAA0CjD,CAAC,EAA3C,EAAiD;AAEhDxB,QAAAA,QAAQ,CAAC0E,mBAAT,CAA8BL,aAA9B,EAA6C7C,CAA7C;AACAgB,QAAAA,KAAK,CAACkC,mBAAN,CAA2BH,UAA3B,EAAuC/C,CAAvC;AAEA,cAAMmD,QAAQ,GAAGd,IAAI,CAACe,KAAL,CAAYpD,CAAZ,CAAjB;AACA,cAAMG,OAAO,GAAGgD,QAAQ,CAAE,CAAF,CAAxB;;AAEA,YAAK,CAAEvF,cAAc,CAAEuC,OAAF,CAArB,EAAmC;AAElC,gBAAMwB,MAAM,GAAGF,aAAa,CAAE5D,UAAF,CAA5B;AACA,gBAAM+D,OAAO,GAAGD,MAAM,CAACE,UAAP,CAAmB,IAAnB,CAAhB;AAEAhB,UAAAA,QAAQ,CAAEe,OAAF,EAAWD,MAAM,CAACZ,KAAlB,EAAyBY,MAAM,CAACnB,MAAhC,EAAwCQ,KAAxC,CAAR;AAEA,gBAAMqC,OAAO,GAAG1B,MAAM,CAAC2B,SAAP,EAAhB;AAEA1F,UAAAA,cAAc,CAAEuC,OAAF,CAAd,GAA4BkD,OAA5B;AAEA;;AAED,cAAME,WAAW,GAAG3F,cAAc,CAAEuC,OAAF,CAAlC;AAEA,cAAMqD,IAAI,GAAG1F,QAAQ,CAACC,aAAT,CAAwB,KAAxB,CAAb;AACAyF,QAAAA,IAAI,CAACpE,GAAL,GAAWmE,WAAX;AAEA,cAAMrD,MAAM,GAAG,IAAIvD,WAAJ,CAAiB6G,IAAjB,CAAf;AACAtD,QAAAA,MAAM,CAAC1B,QAAP,CAAgBiF,IAAhB,CAAsBjF,QAAtB;AACA0B,QAAAA,MAAM,CAAC1B,QAAP,CAAgBkF,cAAhB,CAAgC,EAAhC;AAEAxD,QAAAA,MAAM,CAACyD,gBAAP,GAA0B,KAA1B;AACAzD,QAAAA,MAAM,CAAC0D,YAAP;AAEA3G,QAAAA,IAAI,CAAC2B,GAAL,CAAUsB,MAAV;AAEAhD,QAAAA,OAAO,CAAC2G,IAAR,CAAc3D,MAAd;AAEA;;AAED,YAAM4D,aAAa,GAAG1B,aAAa,CAACU,YAAd,CAA4B,UAA5B,CAAtB;AAEA,YAAMiB,KAAK,GAAG,IAAIzH,KAAK,CAACc,OAAV,EAAd;AACA,YAAM4G,GAAG,GAAG,IAAI1H,KAAK,CAACc,OAAV,EAAZ;;AAEA,WAAM,IAAI4C,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG8D,aAAa,CAACb,KAAnC,EAA0CjD,CAAC,IAAI,CAA/C,EAAmD;AAElD+D,QAAAA,KAAK,CAACb,mBAAN,CAA2BY,aAA3B,EAA0C9D,CAA1C;AACAgE,QAAAA,GAAG,CAACd,mBAAJ,CAAyBY,aAAzB,EAAwC9D,CAAC,GAAG,CAA5C;AAEA+D,QAAAA,KAAK,CAACL,cAAN,CAAsB,EAAtB;AACAM,QAAAA,GAAG,CAACN,cAAJ,CAAoB,EAApB;AAEAvG,QAAAA,OAAO,CAAC8G,UAAR,CAAoBD,GAApB,EAAyBD,KAAzB;AACA,cAAMG,UAAU,GAAG/G,OAAO,CAAC8C,MAAR,KAAmB,EAAtC,CATkD,CAWlD;;AAEA,YAAIkE,IAAI,GAAGrG,QAAQ,CAACC,aAAT,CAAwB,KAAxB,CAAX;AACAoG,QAAAA,IAAI,CAACC,SAAL,GAAiB,MAAjB;AACAD,QAAAA,IAAI,CAAC/D,KAAL,CAAWI,MAAX,GAAoB0D,UAAU,GAAG,IAAjC;AAEA,YAAIhE,MAAM,GAAG,IAAIxD,WAAJ,CAAiByH,IAAjB,CAAb;AACAjE,QAAAA,MAAM,CAAC1B,QAAP,CAAgBiF,IAAhB,CAAsBM,KAAtB;AACA7D,QAAAA,MAAM,CAAC1B,QAAP,CAAgB6F,IAAhB,CAAsBL,GAAtB,EAA2B,GAA3B;AAEA9D,QAAAA,MAAM,CAACO,QAAP,CAAgBG,eAAhB,GAAkCsD,UAAU,GAAG,IAA/C;AACAhE,QAAAA,MAAM,CAACO,QAAP,CAAgBC,cAAhB,GAAmCwD,UAAU,GAAG,EAAf,GAAsB,IAAvD,CAtBkD,CAwBlD;;AAEA,cAAMI,IAAI,GAAGjH,OAAO,CAACkH,GAAR,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAuBC,KAAvB,CAA8BrH,OAA9B,CAAb;AACA,cAAMsH,OAAO,GAAGC,IAAI,CAACC,IAAL,CAAWrH,OAAO,CAACiH,GAAR,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAuBK,GAAvB,CAA4BrH,OAAO,CAACkG,IAAR,CAActG,OAAd,EAAwB0H,SAAxB,EAA5B,CAAX,CAAhB;AAEA,cAAMC,SAAS,GAAG,IAAIxI,KAAK,CAACyI,OAAV,GAAoBC,gBAApB,CAAsCV,IAAI,CAACO,SAAL,EAAtC,EAAwDJ,OAAxD,CAAlB;AACAvE,QAAAA,MAAM,CAAC+E,MAAP,CAAcxB,IAAd,CAAoBqB,SAApB;AACA5E,QAAAA,MAAM,CAACgF,UAAP,CAAkBC,qBAAlB,CAAyCjF,MAAM,CAAC+E,MAAhD;AAEA/E,QAAAA,MAAM,CAACyD,gBAAP,GAA0B,KAA1B;AACAzD,QAAAA,MAAM,CAAC0D,YAAP;AAEA3G,QAAAA,IAAI,CAAC2B,GAAL,CAAUsB,MAAV;AAEAhD,QAAAA,OAAO,CAAC2G,IAAR,CAAc3D,MAAd,EAtCkD,CAwClD;;AAEAiE,QAAAA,IAAI,GAAGrG,QAAQ,CAACC,aAAT,CAAwB,KAAxB,CAAP;AACAoG,QAAAA,IAAI,CAACC,SAAL,GAAiB,MAAjB;AACAD,QAAAA,IAAI,CAAC/D,KAAL,CAAWI,MAAX,GAAoB0D,UAAU,GAAG,IAAjC;AAEA,cAAMkB,KAAK,GAAG,IAAI9I,KAAK,CAACqC,QAAV,CAAoBwF,IAApB,CAAd;AACAiB,QAAAA,KAAK,CAAC5G,QAAN,CAAeiF,IAAf,CAAqBM,KAArB;AACAqB,QAAAA,KAAK,CAAC5G,QAAN,CAAe6F,IAAf,CAAqBL,GAArB,EAA0B,GAA1B;AAEAoB,QAAAA,KAAK,CAACH,MAAN,CAAaxB,IAAb,CAAmBqB,SAAnB;AACAM,QAAAA,KAAK,CAACF,UAAN,CAAiBC,qBAAjB,CAAwCC,KAAK,CAACH,MAA9C;AAEAG,QAAAA,KAAK,CAACzB,gBAAN,GAAyB,KAAzB;AACAyB,QAAAA,KAAK,CAACxB,YAAN;AAEA1D,QAAAA,MAAM,GAAG,IAAIxD,WAAJ,CAAiByH,IAAjB,CAAT;AACAjE,QAAAA,MAAM,CAACmF,QAAP,CAAgBzC,CAAhB,GAAoB8B,IAAI,CAACY,EAAL,GAAU,CAA9B;AAEApF,QAAAA,MAAM,CAACyD,gBAAP,GAA0B,KAA1B;AACAzD,QAAAA,MAAM,CAAC0D,YAAP;AAEA1D,QAAAA,MAAM,CAACO,QAAP,CAAgBG,eAAhB,GAAkCsD,UAAU,GAAG,IAA/C;AACAhE,QAAAA,MAAM,CAACO,QAAP,CAAgBC,cAAhB,GAAmCwD,UAAU,GAAG,EAAf,GAAsB,IAAvD;AAEAhE,QAAAA,MAAM,CAACO,QAAP,CAAgB2E,KAAhB,GAAwBA,KAAxB;AAEAA,QAAAA,KAAK,CAACxG,GAAN,CAAWsB,MAAX;AACAjD,QAAAA,IAAI,CAAC2B,GAAL,CAAUwG,KAAV;AAEAlI,QAAAA,OAAO,CAAC2G,IAAR,CAAc3D,MAAd;AAEA,OAtIiC,CAwIlC;;;AAEA,cAASzC,iBAAT;AAEC,aAAK,CAAL;AACCsC,UAAAA,SAAS;AACT;;AACD,aAAK,CAAL;AACCQ,UAAAA,SAAS;AACT;;AACD,aAAK,CAAL;AACCI,UAAAA,cAAc;AACd;AAVF;AAcA,KAxJD;AA2JA,GA1ZgB,CA4ZjB;;;AAEA,WAASrB,cAAT,GAA0B;AAEzBzC,IAAAA,MAAM,CAAC0I,MAAP,GAAgBlH,MAAM,CAACC,UAAP,GAAoBD,MAAM,CAACE,WAA3C;AACA1B,IAAAA,MAAM,CAAC2I,sBAAP;AAEAzI,IAAAA,QAAQ,CAAC8B,OAAT,CAAkBR,MAAM,CAACC,UAAzB,EAAqCD,MAAM,CAACE,WAA5C;AAEA;;AAED,WAASJ,OAAT,GAAmB;AAElBsH,IAAAA,qBAAqB,CAAEtH,OAAF,CAArB;AACAnB,IAAAA,QAAQ,CAAC0I,MAAT;AAEA,UAAMC,IAAI,GAAGC,IAAI,CAACC,GAAL,KAAa,MAA1B,CALkB,CAOlB;;AACA5I,IAAAA,IAAI,CAACoI,QAAL,CAAczC,CAAd,GAAkB+C,IAAI,GAAG,GAAzB;AAEAG,IAAAA,MAAM;AAEN;;AAED,WAASA,MAAT,GAAkB;AAEjB/I,IAAAA,QAAQ,CAAC+I,MAAT,CAAiBhJ,KAAjB,EAAwBD,MAAxB,EAFiB,CAGjB;AAEA;;AAEF,SAAQ,IAAR;AACD;;AAED,eAAeD,QAAf","sourcesContent":["import React from \"react\";\nimport * as THREE from 'three';\nimport { TrackballControls } from '../../node_modules/three/examples/jsm/controls/TrackballControls.js';\nimport { PDBLoader } from '../../node_modules/three/examples/jsm/loaders/PDBLoader.js';\nimport { CSS3DRenderer, CSS3DObject, CSS3DSprite } from '../../node_modules/three/examples/jsm/renderers/CSS3DRenderer.js';\n\nfunction MainPage() {\n\n\t\t\tlet camera, scene, renderer;\n\t\t\tlet controls;\n\t\t\tlet root;\n\n\t\t\tconst objects = [];\n\t\t\tconst tmpVec1 = new THREE.Vector3();\n\t\t\tconst tmpVec2 = new THREE.Vector3();\n\t\t\tconst tmpVec3 = new THREE.Vector3();\n\t\t\tconst tmpVec4 = new THREE.Vector3();\n\t\t\tconst offset = new THREE.Vector3();\n\n\t\t\tlet visualizationType = 2;\n\t\t\t\n\t\t\tconst MOLECULES = {\n\t\t\t\t'Rufinamide': 'rufinamide.pdb',\n\t\t\t\t//'Sildenafil': 'sildenafil.pdb',\n\t\t\t\t// 'Lidocaine': 'lidocaine.pdb',\n\t\t\t\t// 'Nytol': 'nytol.pdb',\n\t\t\t\t// 'Rufinamide': 'rufinamide.pdb',\n\t\t\t\t// 'LSD': 'lsd.pdb',\n\t\t\t\t// 'Cocaine': 'cocaine.pdb',\n\t\t\t\t// 'Cholesterol': 'cholesterol.pdb',\n\t\t\t\t// 'Lycopene': 'lycopene.pdb',\n\t\t\t\t// 'Glucose': 'glucose.pdb',\n\t\t\t\t// 'Aluminium oxide': 'Al2O3.pdb',\n\t\t\t\t// 'Cubane': 'cubane.pdb',\n\t\t\t\t// 'Copper': 'cu.pdb',\n\t\t\t\t// 'Fluorite': 'caf2.pdb',\n\t\t\t\t// 'Salt': 'nacl.pdb',\n\t\t\t\t// 'YBCO superconductor': 'ybco.pdb',\n\t\t\t\t// 'Buckyball': 'buckyball.pdb',\n\t\t\t\t// // 'Diamond': 'diamond.pdb',\n\t\t\t\t// 'Graphite': 'graphite.pdb'\n\t\t\t};\n\n\t\t\tconst loader = new PDBLoader();\n\t\t\tconst colorSpriteMap = {};\n\t\t\tconst baseSprite = document.createElement( 'img' );\n\n\t\t\tconst menu = document.getElementById( 'menu' );\n\n\n\t\t\tinit();\n\t\t\tanimate();\n\n\t\t\tfunction init() {\n\n\t\t\t\tcamera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 5000 );\n\t\t\t\tcamera.position.z = 1000;\n\n\t\t\t\tscene = new THREE.Scene();\n\n\t\t\t\troot = new THREE.Object3D();\n\t\t\t\tscene.add( root );\n\n\t\t\t\t//\n\n\t\t\t\trenderer = new CSS3DRenderer();\n\t\t\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\t\t\t\tdocument.getElementById( 'container' ).appendChild( renderer.domElement );\n\n\t\t\t\t//\n\n\t\t\t\tcontrols = new TrackballControls( camera, renderer.domElement );\n\t\t\t\tcontrols.rotateSpeed = 0.5;\n\n\t\t\t\t//\n\t\t\t\t\n\t\t\t\tbaseSprite.onload = function () {\t\t\t\t\t\t\n\n\t\t\t\t\tconst url = './models/pdb/rufinamide.pdb'\n\t\t\t\t\tloadMolecule (url);\n\t\t\t\t\t//createMenu();\n\n\t\t\t\t};\n\n\t\t\t\tbaseSprite.src = './textures/sprites/ball.png';\n\n\t\t\t\t//\n\n\t\t\t\twindow.addEventListener( 'resize', onWindowResize );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tfunction generateButtonCallback( url ) {\n\n\t\t\t\treturn function () {\n\n\t\t\t\t\tloadMolecule( url );\n\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tfunction createMenu() {\n\n\t\t\t\tfor ( const m in MOLECULES ) {\n\t\t\t\t\t\n\n\t\t\t\t\tconst button = document.createElement( 'button' );\n\t\t\t\t\tbutton.innerHTML = m;\n\t\t\t\t\tmenu.appendChild( button );\n\n\t\t\t\t\tconst url = './models/pdb/' + MOLECULES[ m ];\n\n\t\t\t\t\tbutton.addEventListener( 'click', generateButtonCallback( url ) );\n\n\t\t\t\t}\n\n\t\t\t\tconst b_a = document.getElementById( 'b_a' );\n\t\t\t\tconst b_b = document.getElementById( 'b_b' );\n\t\t\t\tconst b_ab = document.getElementById( 'b_ab' );\n\n\t\t\t\tb_a.addEventListener( 'click', function () {\n\n\t\t\t\t\tvisualizationType = 0;\n\t\t\t\t\t// showAtoms();\n\n\t\t\t\t} );\n\t\t\t\tb_b.addEventListener( 'click', function () {\n\n\t\t\t\t\tvisualizationType = 1;\n\t\t\t\t\t// showBonds();\n\n\t\t\t\t} );\n\t\t\t\tb_ab.addEventListener( 'click', function () {\n\n\t\t\t\t\tvisualizationType = 2;\n\t\t\t\t\t// showAtomsBonds();\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tfunction showAtoms() {\n\n\t\t\t\tfor ( let i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tconst object = objects[ i ];\n\n\t\t\t\t\tif ( object instanceof CSS3DSprite ) {\n\n\t\t\t\t\t\tobject.element.style.display = '';\n\t\t\t\t\t\tobject.visible = true;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tobject.element.style.display = 'none';\n\t\t\t\t\t\tobject.visible = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction showBonds() {\n\n\t\t\t\tfor ( let i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tconst object = objects[ i ];\n\n\t\t\t\t\tif ( object instanceof CSS3DSprite ) {\n\n\t\t\t\t\t\tobject.element.style.display = 'none';\n\t\t\t\t\t\tobject.visible = false;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tobject.element.style.display = '';\n\t\t\t\t\t\tobject.element.style.height = object.userData.bondLengthFull;\n\t\t\t\t\t\tobject.visible = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction showAtomsBonds() {\n\n\t\t\t\tfor ( let i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tconst object = objects[ i ];\n\n\t\t\t\t\tobject.element.style.display = '';\n\t\t\t\t\tobject.visible = true;\n\n\t\t\t\t\tif ( ! ( object instanceof CSS3DSprite ) ) {\n\n\t\t\t\t\t\tobject.element.style.height = object.userData.bondLengthShort;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tfunction colorify( ctx, width, height, color ) {\n\n\t\t\t\tconst r = color.r, g = color.g, b = color.b;\n\n\t\t\t\tconst imageData = ctx.getImageData( 0, 0, width, height );\n\t\t\t\tconst data = imageData.data;\n\n\t\t\t\tfor ( let i = 0, l = data.length; i < l; i += 4 ) {\n\n\t\t\t\t\tdata[ i + 0 ] *= r;\n\t\t\t\t\tdata[ i + 1 ] *= g;\n\t\t\t\t\tdata[ i + 2 ] *= b;\n\n\t\t\t\t}\n\n\t\t\t\tctx.putImageData( imageData, 0, 0 );\n\n\t\t\t}\n\n\t\t\tfunction imageToCanvas( image ) {\n\n\t\t\t\tconst width = image.width;\n\t\t\t\tconst height = image.height;\n\n\t\t\t\tconst canvas = document.createElement( 'canvas' );\n\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\n\t\t\t\tconst context = canvas.getContext( '2d' );\n\t\t\t\tcontext.drawImage( image, 0, 0, width, height );\n\n\t\t\t\treturn canvas;\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tfunction loadMolecule( url ) {\n\n\t\t\t\tfor ( let i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tconst object = objects[ i ];\n\t\t\t\t\tobject.parent.remove( object );\n\n\t\t\t\t}\n\n\t\t\t\tobjects.length = 0;\n\n\t\t\t\tloader.load( url, function ( pdb ) {\n\n\t\t\t\t\tconst geometryAtoms = pdb.geometryAtoms;\n\t\t\t\t\tconst geometryBonds = pdb.geometryBonds;\n\t\t\t\t\tconst json = pdb.json;\n\n\t\t\t\t\tgeometryAtoms.computeBoundingBox();\n\t\t\t\t\tgeometryAtoms.boundingBox.getCenter( offset ).negate();\n\n\t\t\t\t\tgeometryAtoms.translate( offset.x, offset.y, offset.z );\n\t\t\t\t\tgeometryBonds.translate( offset.x, offset.y, offset.z );\n\n\t\t\t\t\tconst positionAtoms = geometryAtoms.getAttribute( 'position' );\n\t\t\t\t\tconst colorAtoms = geometryAtoms.getAttribute( 'color' );\n\n\t\t\t\t\tconst position = new THREE.Vector3();\n\t\t\t\t\tconst color = new THREE.Color();\n\n\t\t\t\t\tfor ( let i = 0; i < positionAtoms.count; i ++ ) {\n\n\t\t\t\t\t\tposition.fromBufferAttribute( positionAtoms, i );\n\t\t\t\t\t\tcolor.fromBufferAttribute( colorAtoms, i );\n\n\t\t\t\t\t\tconst atomJSON = json.atoms[ i ];\n\t\t\t\t\t\tconst element = atomJSON[ 4 ];\n\n\t\t\t\t\t\tif ( ! colorSpriteMap[ element ] ) {\n\n\t\t\t\t\t\t\tconst canvas = imageToCanvas( baseSprite );\n\t\t\t\t\t\t\tconst context = canvas.getContext( '2d' );\n\n\t\t\t\t\t\t\tcolorify( context, canvas.width, canvas.height, color );\n\n\t\t\t\t\t\t\tconst dataUrl = canvas.toDataURL();\n\n\t\t\t\t\t\t\tcolorSpriteMap[ element ] = dataUrl;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst colorSprite = colorSpriteMap[ element ];\n\n\t\t\t\t\t\tconst atom = document.createElement( 'img' );\n\t\t\t\t\t\tatom.src = colorSprite;\n\n\t\t\t\t\t\tconst object = new CSS3DSprite( atom );\n\t\t\t\t\t\tobject.position.copy( position );\n\t\t\t\t\t\tobject.position.multiplyScalar( 75 );\n\n\t\t\t\t\t\tobject.matrixAutoUpdate = false;\n\t\t\t\t\t\tobject.updateMatrix();\n\n\t\t\t\t\t\troot.add( object );\n\n\t\t\t\t\t\tobjects.push( object );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst positionBonds = geometryBonds.getAttribute( 'position' );\n\n\t\t\t\t\tconst start = new THREE.Vector3();\n\t\t\t\t\tconst end = new THREE.Vector3();\n\n\t\t\t\t\tfor ( let i = 0; i < positionBonds.count; i += 2 ) {\n\n\t\t\t\t\t\tstart.fromBufferAttribute( positionBonds, i );\n\t\t\t\t\t\tend.fromBufferAttribute( positionBonds, i + 1 );\n\n\t\t\t\t\t\tstart.multiplyScalar( 75 );\n\t\t\t\t\t\tend.multiplyScalar( 75 );\n\n\t\t\t\t\t\ttmpVec1.subVectors( end, start );\n\t\t\t\t\t\tconst bondLength = tmpVec1.length() - 50;\n\n\t\t\t\t\t\t//\n\n\t\t\t\t\t\tlet bond = document.createElement( 'div' );\n\t\t\t\t\t\tbond.className = 'bond';\n\t\t\t\t\t\tbond.style.height = bondLength + 'px';\n\n\t\t\t\t\t\tlet object = new CSS3DObject( bond );\n\t\t\t\t\t\tobject.position.copy( start );\n\t\t\t\t\t\tobject.position.lerp( end, 0.5 );\n\n\t\t\t\t\t\tobject.userData.bondLengthShort = bondLength + 'px';\n\t\t\t\t\t\tobject.userData.bondLengthFull = ( bondLength + 55 ) + 'px';\n\n\t\t\t\t\t\t//\n\n\t\t\t\t\t\tconst axis = tmpVec2.set( 0, 1, 0 ).cross( tmpVec1 );\n\t\t\t\t\t\tconst radians = Math.acos( tmpVec3.set( 0, 1, 0 ).dot( tmpVec4.copy( tmpVec1 ).normalize() ) );\n\n\t\t\t\t\t\tconst objMatrix = new THREE.Matrix4().makeRotationAxis( axis.normalize(), radians );\n\t\t\t\t\t\tobject.matrix.copy( objMatrix );\n\t\t\t\t\t\tobject.quaternion.setFromRotationMatrix( object.matrix );\n\n\t\t\t\t\t\tobject.matrixAutoUpdate = false;\n\t\t\t\t\t\tobject.updateMatrix();\n\n\t\t\t\t\t\troot.add( object );\n\n\t\t\t\t\t\tobjects.push( object );\n\n\t\t\t\t\t\t//\n\n\t\t\t\t\t\tbond = document.createElement( 'div' );\n\t\t\t\t\t\tbond.className = 'bond';\n\t\t\t\t\t\tbond.style.height = bondLength + 'px';\n\n\t\t\t\t\t\tconst joint = new THREE.Object3D( bond );\n\t\t\t\t\t\tjoint.position.copy( start );\n\t\t\t\t\t\tjoint.position.lerp( end, 0.5 );\n\n\t\t\t\t\t\tjoint.matrix.copy( objMatrix );\n\t\t\t\t\t\tjoint.quaternion.setFromRotationMatrix( joint.matrix );\n\n\t\t\t\t\t\tjoint.matrixAutoUpdate = false;\n\t\t\t\t\t\tjoint.updateMatrix();\n\n\t\t\t\t\t\tobject = new CSS3DObject( bond );\n\t\t\t\t\t\tobject.rotation.y = Math.PI / 2;\n\n\t\t\t\t\t\tobject.matrixAutoUpdate = false;\n\t\t\t\t\t\tobject.updateMatrix();\n\n\t\t\t\t\t\tobject.userData.bondLengthShort = bondLength + 'px';\n\t\t\t\t\t\tobject.userData.bondLengthFull = ( bondLength + 55 ) + 'px';\n\n\t\t\t\t\t\tobject.userData.joint = joint;\n\n\t\t\t\t\t\tjoint.add( object );\n\t\t\t\t\t\troot.add( joint );\n\n\t\t\t\t\t\tobjects.push( object );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t//console.log( \"CSS3DObjects:\", objects.length );\n\n\t\t\t\t\tswitch ( visualizationType ) {\n\n\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\tshowAtoms();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tshowBonds();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\tshowAtomsBonds();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tfunction onWindowResize() {\n\n\t\t\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\t\t\tcamera.updateProjectionMatrix();\n\n\t\t\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t\t\t}\n\n\t\t\tfunction animate() {\n\n\t\t\t\trequestAnimationFrame( animate );\n\t\t\t\tcontrols.update();\n\n\t\t\t\tconst time = Date.now() * 0.0004;\n\n\t\t\t\t// root.rotation.x = time;\n\t\t\t\troot.rotation.y = time * 0.7;\n\n\t\t\t\trender();\n\n\t\t\t}\n\n\t\t\tfunction render() {\n\n\t\t\t\trenderer.render( scene, camera );\n\t\t\t\t//requestAnimationFrame(render);\n\n\t\t\t}\n\n  return (null);\n}\n\nexport default MainPage;\n"]},"metadata":{},"sourceType":"module"}